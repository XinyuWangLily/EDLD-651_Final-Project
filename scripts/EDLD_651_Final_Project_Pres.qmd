---
title: "Final Project"
authors: "Xinyu (Lily) Wang, Sophie Hartford, Everett Mahaffy"
format:
  revealjs:
    embed-resources: true
    smaller: true
    theme: night
    slide-number: true
execute:
  eval: true
  echo: true
warning: false
message: false
bibliography: references.bib
csl: apa.csl
---

# Study/Data Info

We are utilizing data from the longitudinal study “Transitions in Adolescent Girls,” [@barendse2019] specifically focusing on data from baseline (Wave 1). This dataset includes 174 participants who were 10-13 at the baseline. Our variables of interest are emotion regulation strategy use and depressive symptoms. These were measured using the Emotion Regulation Questionnaire (ERQ) [@gross2003] and the Center for Epidemiological Studies Depression Scale for Children (CES- DC). [@weissman1980] These are continuous scales which provide total scores for reappraisal and suppression (ERQ) and depressive symptoms (CES-DC).

# Topic Overview

Adolescence is a pivotal period of development characterized by rapid physical, social, and emotional change [@guyer2016; @nelson2016] Early adolescence has been proposed as a particularly crucial period for the development of emotion regulation [@silvers2022], the processes by which individuals moderate and modulate their emotional experiences and expression [@gross1998; @gross2015]. Additionally, adolescents face heightened vulnerability to the depressive symptoms [@kessler2007], with depression rates spiking between early and middle adolescence and even steeper rates for girls [@hankin2007].

![](images/Adolescent depression_3.jpg){fig-align="center"}

# Present Study

Drawing upon the longitudinal TAG dataset, we sought to examine whether two particularly salient and well-studied emotion regulation strategies (reappraisal and suppression) were associated with depressive symptoms in early adolescent girls (age 10-13).

These findings will serve as a foundation for future studies investigating these relations across time utilizing all six waves of the data.

Research Questions:

-   Is higher reappraisal use associated with lower depressive symptoms in adolescent girls?
-   Is higher suppression use associated with higher depressive symptoms in adolescent girls?

# Load packages

```{r}
library(tidyverse)
library(flextable)
library(here)
library(readxl)
library(modelsummary)
library(janitor)
library(performance)
```

# Load data

We first had to load in four separate datasets to join which contained age, race, emotion regulation, and depressive symptoms:

```{r}
# Demographic
age <- read_csv(here("data", "TAG_age_session_dates_4waves.csv"))
age <- clean_names(age)

race <- read_excel(here("data", "TAG_W1_Race_Ethnicity.xlsx"))
race <- clean_names(race)

# Emotion Regulation(ERQ)
erq <- read_csv(here("data", "ERQ_Wave1.csv"))
erq <- erq %>% 
       clean_names() %>% 
       distinct(tagid, .keep_all = TRUE)

# Adolescent Depression(CESDC)
cesdc <- read_csv(here("data", "CESDC_Wave1.csv"))
cesdc <- clean_names(cesdc)

```

# Participant Demographics

Race/ethnicity category

First we had to clean the race/ethnicity data by identifying subjects reported multiple racial categories and rename them to "Multi-racial"

```{r}
race_clean <- race %>%
  mutate(
    w1_ethnicity = as.character(w1_ethnicity),
    w1_ethnicity = if_else(
      str_detect(w1_ethnicity, ","),
      "g. Multi-racial",
      w1_ethnicity
    )
  )
```

# Race/ethnicity distribution
```{r}
race_clean %>%
  count(w1_ethnicity) %>%
  ggplot(aes(x = fct_reorder(w1_ethnicity, n), y = n, fill = w1_ethnicity)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(
    title = "Distribution of Race/Ethnicity in Sample",
    x = "Race/Ethnicity",
    y = "Number of Participants"
  ) +
  theme_minimal(base_size = 13)
```

# Participant demographics cont.

Age

Each wave consisted of two sessions, so we had to calculate the average age between sessions:

```{r}
age <- age %>% 
  mutate(W1_mean_age = (w1s1_age + w1s2_age)/2) 

# Check mean age for sample
age_summary <- age %>%
  summarize(
    mean_W1_age = mean(W1_mean_age, na.rm = TRUE),
    sd_W1_age   = sd(W1_mean_age, na.rm = TRUE),
  )
print(age_summary)
```

# Joining all datasets

```{r}
df <- erq %>% 
  left_join(cesdc, by= 'tagid')

df <- df %>% 
     left_join(age, by = 'tagid')

df <- df %>% 
     left_join(race_clean, by = 'tagid') %>% 
     select(tagid, erq_reappraisal_total, erq_suppression_total, ces_dc_total_75perc, W1_mean_age, w1_ethnicity, 
            w1s1_date, w1s1_age, w1s2_date, w1s2_age, w2s1_date, w2s1_age, w2s2_date, w2s2_age, 
            w3s1_date, w3s1_age, w3s2_date, w3s2_age, w4s1_date, w4s1_age, w4s2_date, w4s2_age
            )
```

# Renaming

In order to tidy the data, we first had to rename each wave/session/date/age variable

```{r}
df <- df %>%
  rename(
    wave1_session1_date = w1s1_date,
    wave1_session1_age  = w1s1_age,
    wave1_session2_date = w1s2_date,
    wave1_session2_age  = w1s2_age,

    wave2_session1_date = w2s1_date,
    wave2_session1_age  = w2s1_age,
    wave2_session2_date = w2s2_date,
    wave2_session2_age  = w2s2_age,

    wave3_session1_date = w3s1_date,
    wave3_session1_age  = w3s1_age,
    wave3_session2_date = w3s2_date,
    wave3_session2_age  = w3s2_age,

    wave4_session1_date = w4s1_date,
    wave4_session1_age  = w4s1_age,
    wave4_session2_date = w4s2_date,
    wave4_session2_age  = w4s2_age
  )
```

# Tidy and filter

```{r}
# Tidy
df2 <- df %>%
  mutate(across(starts_with("wave"), as.character))

df_long <- df2 %>%
  pivot_longer(
    cols = starts_with("wave"),
    names_to = c("wave", "session", "info"),
    names_sep = "_",
    values_to = "value"
  ) %>%
  mutate(
    wave    = parse_number(wave),
    session = parse_number(session)
  )

df_tidy <- df_long %>%
  pivot_wider(
    names_from = info,
    values_from = value
  ) %>% 
  mutate(age = as.numeric(age))


# Filter
df_final <- df_tidy %>% 
  filter(wave == 1, session == 1)

```

# Results

# Cohort Plot

```{r echo=FALSE}
ggplot(df_tidy, aes(x = age, y = tagid)) +
  geom_line(aes(group = tagid), size = .5, alpha = .4) +
  geom_point(aes(color = as.factor(wave)), size = 2) +
  labs(
    x = "Age",
    y = "TAG Participant",
    title = "Age by Wave",
    color = "Wave"
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  ) +
 scale_x_continuous(breaks = seq(10, 20, by = 0.5))

```

# Sample Summary Statistics

```{r}
df_names <- df_tidy %>% 
    select(-wave, -session, -age) %>% 
    rename(
    Reappraisal       = erq_reappraisal_total,
    Suppression       = erq_suppression_total,
    Depression        = ces_dc_total_75perc,
    Age               = W1_mean_age,
    Ethnicity         = w1_ethnicity
    )
```

# Summary Stats Table

```{r}
datasummary_skim(df_names,
                 title = "Table 1. Sample Descriptive Statistics")
```

# Primary RQs

Is higher emotion reappraisal associated with lower depression symptoms in adolescent girls?

```{r}
rq1 <- lm(df_tidy$ces_dc_total_75perc ~ df_tidy$erq_reappraisal_total)
```

Is higher emotion suppression associated with higher depression symptoms in adolescent girls?

```{r}
rq2 <- lm(df_tidy$ces_dc_total_75perc ~ df_tidy$erq_suppression_total)
```

# Exploratory RQs:

Is higher suppression use associated with higher depression symptoms when adjusting for reappraisal use?

```{r}
ex1 <- lm(df_tidy$ces_dc_total_75perc ~ df_tidy$erq_suppression_total + df_tidy$erq_reappraisal_total)
```

Does age moderate the relation between reappraisal/suppression and depression symptoms in adolescent girls?

```{r}
ex2 <- lm(df_tidy$ces_dc_total_75perc ~ df_tidy$erq_reappraisal_total * df_tidy$W1_mean_age)

ex3 <- lm(df_tidy$ces_dc_total_75perc ~ df_tidy$erq_suppression_total * df_tidy$W1_mean_age)
```

# Primary RQ Model Summaries

```{r echo=FALSE}
modelsummary(
  list(
    "Reappraisal" = rq1,
    "Suppression" = rq2),
  coef_map = c(
    "(Intercept)"                     = "Intercept",
    "df_tidy$erq_reappraisal_total"   = "Reappraisal (ERQ)",
    "df_tidy$erq_suppression_total"   = "Suppression (ERQ)"
  ),
  stars = TRUE,
  gof_omit = ".*",
  title = "Table 2. Model Summary for RQ1 and RQ2"
  )
```

# Exploratory Results

```{r echo=FALSE}
modelsummary(
  list(
    "Suppression + Reappraisal" = ex1,
    "Reappraisal × Age Interaction" = ex2,
    "Suppression × Age Interaction" = ex3),
    coef_map = c(
    "(Intercept)"                     = "Intercept",
    "df_tidy$erq_reappraisal_total"   = "Reappraisal (ERQ)",
    "df_tidy$erq_suppression_total"   = "Suppression (ERQ)",
    "df_tidy$erq_reappraisal_total:df_tidy$W1_mean_age" = "Reappraisal x Age",
    "df_tidy$erq_suppression_total:df_tidy$W1_mean_age" = "Suppression x Age"),
  stars = TRUE,
  gof_omit = ".*",
  title = "Table 3. Model Summaries for Multiple Regression and Interaction Models"
  )
```

# Plot 1

This plot shows the relation between reappraisal and depressive symptoms

```{r echo=FALSE}
ggplot(df_tidy, aes(x=erq_reappraisal_total, y=ces_dc_total_75perc))+
  geom_point(color="Dodgerblue3")+
  geom_smooth(method = lm, color="Aquamarine3")+
  labs(x="Reappraisal", y="Depression")
```

# Plot 2

This plot shows the relation between suppression and depressive symptoms

```{r echo=FALSE}
ggplot(df_tidy,aes(x=erq_suppression_total, y=ces_dc_total_75perc))+
  geom_point(color="Dodgerblue3")+
  geom_smooth(method = lm, color="Aquamarine3")+
  labs(x="Suppression", y="Depression")
```

# Reflections

-   Most of our time was spent cleaning/managing the data - the models were quick!
-   Pivoting can be challenging and renaming can help
-   Don't forget to make sure your variables are numeric after pivoting

# Future Directions
- Investigate longitudinal association between emotion regulation and depressive symptoms among adolescent girls.
- Examine potential moderators and mediators such as brain circuit, puberty stage, and socioeconomic factors. 
- Test the reproducibility of the results using other dataset with larger sample size.

# References
